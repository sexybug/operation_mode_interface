
#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <time.h>
#include <gmssl/error.h>
#include <gmssl/sm2.h>
#include "../test/test.h"

void test_gmssl_sm2_enc()
{
	SM2_KEY sm2_key;

	uint8_t private_key[32] = { 0x81,0x57,0x15,0x0A,0xE3,0x1D,0xEB,0xCD,0x8A,0x8D,0x4D,0x83,0x67,0x90,0x03,0x15,0xB8,0x27,0x2C,0x34,0x4F,0x36,0x92,0xB0,0xA8,0x8F,0x56,0x3F,0x5B,0xA6,0x56,0xEC };
	uint8_t pub_key[64];
	uint8_t cipher[122] = { 0x30,0x78,0x02,0x20,0x17,0xE7,0xD7,0x71,0xF1,0x81,0x89,0xE2,0xC4,0x6D,0x8D,0xB2,0x8B,0x65,0xB2,0x27,0x4B,0xB2,0x4E,0xB3,0x28,0x39,0xA4,0x1A,0x2B,0x96,0x2E,0xB4,0x42,0xEA,0x74,0x0B,0x02,0x20,0x4D,0x82,0xCD,0x6E,0xE3,0x8E,0x52,0x5B,0x27,0x1A,0x87,0xA4,0xBC,0x66,0x34,0x5E,0x1D,0x4B,0xAC,0x48,0x9E,0x45,0x0D,0xD9,0xFA,0x5E,0x0D,0x4E,0x02,0x78,0xA7,0xA1,0x04,0x20,0x2C,0x98,0xE8,0x5E,0x20,0xDA,0x65,0xA4,0xA4,0xA1,0x91,0x15,0x1E,0x7F,0x05,0x10,0x3A,0x1B,0xD4,0xCB,0x50,0xA3,0x91,0xEC,0xB8,0x29,0x62,0xEA,0x89,0x8A,0x5E,0xC8,0x04,0x10,0xDD,0x11,0x78,0x52,0xAC,0x76,0xE8,0xF4,0x14,0x36,0x42,0x70,0xDA,0x00,0xF1,0xB3 };
	uint8_t plain[122 - 96];
	size_t plain_len = 0;

	sm2_z256_from_bytes(sm2_key.private_key, private_key);

	sm2_z256_point_mul_generator(&sm2_key.public_key, sm2_key.private_key);

	sm2_z256_point_to_bytes(&sm2_key.public_key, pub_key);

	print_u8("private_key", private_key, 32);
	print_u8("pub_key", pub_key, 64);
	print_u8("cipher", cipher, sizeof(cipher));

	int ret = sm2_decrypt(&sm2_key, cipher, sizeof(cipher), plain, &plain_len);

	printf("dec return: %d \n", ret);
	print_u8("plain", plain, plain_len);
}